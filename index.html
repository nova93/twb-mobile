<!DOCTYPE html>
<html>
<head>
	<title>The Whiteboard Mobile</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		img {

		}
	</style>
</head>
<body>
	<a href="?page=autowb001.html">First</a> | 
	<a href="#" id="prev">Previous</a> | 
	<a href="#" id="next">Next</a> | 
	<a href="">Todays</a>
	<script type="text/javascript">
		getUrlVars = () => {
		    const vars = {};
		    const parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, (m,key,value) => {
		        vars[key] = value;
		    });
		    return vars;
		}
		const proxyUrl = 'https://yacdn.org/serve/';
		let twbUrl = 'http://the-whiteboard.com';
		if (getUrlVars()['page']) {
			twbUrl = 'http://the-whiteboard.com/' + getUrlVars()['page'];
		}
		const url = proxyUrl + twbUrl;

		// image
		const regex = /<br><img SRC=".*"><br>/gmi;
		const regex2 = /".*"/gmi;

		// buttons
		const regex3 = /<a href=".{4,15}\.html"><img src="previous\.png"><\/a>/gmi; // previous
		const regex4 = /<a href=".{4,15}\.html"><img src="next\.png"><\/a>/gmi; // next

		fetch(url).then( response => {
			if(response.ok) {
				return response.text();
			}
			throw new Error('Network response was not ok.');
		}).then( rawResponse => {
			let imgName = rawResponse.match(regex)[0].match(regex2)[0]; //there is probably a better way to do that EDIT: there is, use what i've done to prevBtn...
			imgName = imgName.substring(1, imgName.length - 1);
			showImage(imgName);

			let prevBtn = rawResponse.match(regex3)[0];
			if (prevBtn) {
				prevBtn = prevBtn.substring(9, prevBtn.length - 30);
				document.getElementById('prev').setAttribute('href', '?page=' + prevBtn);
			}
			console.log(rawResponse.match(regex4));
			let nextBtn = rawResponse.match(regex4)[0];
			if (nextBtn) {
				nextBtn = nextBtn.substring(9, nextBtn.length - 26);
				document.getElementById('next').setAttribute('href', '?page=' + nextBtn);
			}

		}).catch( error => {
		  console.log('There has been a problem with your fetch operation: ', error.message);
		});

		const loadImage = url => {
		  	return new Promise( (resolve, reject) => {
			    const image = new Image();
			    image.src = url;
			    image.onload = () => {
		    		resolve(image.src);
		    	};
		    	image.onerror = () => {
		    		reject(new Error('Could not load image at ' + url));
		    	};
			});
		}
		const handleSuccess = resolvedValue => {
			const comic = new Image();
			comic.src = resolvedValue;
			document.body.appendChild(comic);
		}
		const handleFailure = rejectionReason => {
			console.log(rejectionReason);
		}
		const showImage = (url) => {
			const path = 'http://the-whiteboard.com/' + url;
			loadImage(path).then(handleSuccess, handleFailure);
		}
	</script>
</body>
</html>